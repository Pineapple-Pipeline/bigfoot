!function(){var F;(F=jQuery).bigfoot=function(t){var o,e,l,f,n,i,r,d,a,s,c,u=void 0,v=F.extend({actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,anchorParentTagname:"sup",breakpoints:{},deleteOnUnhover:!1,footnoteParentClass:"footnote",footnoteTagname:"li",hoverDelay:250,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:"<aside class='bigfoot-footnote is-positioned-bottom' data-footnote-number='{{FOOTNOTENUM}}' data-footnote-identifier='{{FOOTNOTEID}}' alt='Footnote {{FOOTNOTENUM}}'> <div class='bigfoot-footnote__wrapper'> <div class='bigfoot-footnote__content'> {{FOOTNOTECONTENT}} </div></div> <div class='bigfoot-footnote__tooltip'></div> </aside>",buttonMarkup:"<div class='bigfoot-footnote__container'> <button class='bigfoot-footnote__button' id='{{SUP:data-footnote-backlink-ref}}' data-footnote-number='{{FOOTNOTENUM}}' data-footnote-identifier='{{FOOTNOTEID}}' alt='See Footnote {{FOOTNOTENUM}}' rel='footnote' data-bigfoot-footnote='{{FOOTNOTECONTENT}}'> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> </button></div>"},t),p={},g=function(){var t,o,e,n,i,a,r,s,l,c,f,d,u=v.scope?v.scope+" a[href*='#']":"a[href*='#']",u=F(u).filter(function(){var t=F(this),o=t.attr("rel");return"null"!==o&&null!=o||(o=""),(""+t.attr("href")+o).match(v.anchorPattern)&&t.closest(`[class*=${v.footnoteParentClass}]:not(a):not(${v.anchorParentTagname})`).length<1}),p=[],g=[],h=[];for(b(u,g),F(g).each(function(){var t=F(this).data("footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&");if(v.useFootnoteOnlyOnce&&(t+=":not(.footnote-processed)"),0<(t=F(t).closest(v.footnoteTagname)).length)return p.push(t.first().addClass("footnote-processed")),h.push(this)}),r=(u=F("[data-footnote-identifier]:last")).length<1?0:+u.data("footnote-identifier"),d=[],l=c=0,f=p.length;0<=f?c<f:f<c;l=0<=f?++c:--c)switch(a=(a=O(F(p[l]).html().trim(),F(h[l]).data("footnote-backlink-ref"))).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;").replace(/'/g,"&apos;"),r+=1,e=F(h[l]),n=F(p[l]),null!=v.numberResetSelector?((i=e.closest(v.numberResetSelector)).is(t)?s+=1:s=1,t=i):s=r,0!==a.indexOf("<")&&(a=`<p>${a}</p>`),i=v.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,s).replace(/\{\{FOOTNOTEID\}\}/g,r).replace(/\{\{FOOTNOTECONTENT\}\}/g,a),i=_(i,"SUP",e),i=_(i,"FN",n),F(i).insertBefore(e),o=n.parent(),v.actionOriginalFN.toLowerCase()){case"hide":e.addClass("footnote-print-only"),n.addClass("footnote-print-only"),d.push(m(o));break;case"delete":e.remove(),n.remove(),d.push(m(o));break;default:d.push(e.addClass("footnote-print-only"))}return d},b=function(t,e=[]){var n,i=void 0,a=void 0;t.each(function(){var t,o=F(this);return n="#"+o.attr("href").split("#")[1],i=o.closest(v.anchorParentTagname),t=o.find(v.anchorParentTagname),0<i.length?(a=(i.attr("id")||"")+(o.attr("id")||""),e.push(i.attr({"data-footnote-backlink-ref":a,"data-footnote-ref":n}))):(a=0<t.length?(t.attr("id")||"")+(o.attr("id")||""):o.attr("id")||"",e.push(o.attr({"data-footnote-backlink-ref":a,"data-footnote-ref":n})))})},m=function(t){var o=void 0;return t.is(":empty")||0===t.children(":not(.footnote-print-only)").length?(o=t.parent(),"delete"===v.actionOriginalFN.toLowerCase()?t.remove():t.addClass("footnote-print-only"),m(o)):t.children(":not(.footnote-print-only)").length===t.children("hr:not(.footnote-print-only)").length?(o=t.parent(),"delete"===v.actionOriginalFN.toLowerCase()?t.remove():(t.children("hr").addClass("footnote-print-only"),t.addClass("footnote-print-only")),m(o)):void 0},O=function(t,o){return 0<=o.indexOf(" ")&&(o=o.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),o=new RegExp(`(\\s|&nbsp;)*<\\s*a[^#<]*#${o}[^>]*>(.*?)<\\s*/\\s*a>`,"g"),t.replace(o,"").replace("[]","")},_=function(t,o,e){var n,i=new RegExp(`\\{\\{${o}:([^\\}]*)\\}\\}`,"g"),a=void 0;for(a=i.exec(t);a;)a[1]&&(n=e.attr(a[1])||"",t=t.replace(`{{${o}:${a[1]}}}`,n)),a=i.exec(t);return t},h=function(t){var o;v.activateOnHover&&(o=`[data-footnote-identifier='${(t=F(t.target).closest(".bigfoot-footnote__button")).attr("data-footnote-identifier")}']`,t.hasClass("is-active")||(t.addClass("is-hover-instantiated"),v.allowMultipleFN||i(`.bigfoot-footnote:not(${o})`),y(".bigfoot-footnote__button"+o).addClass("is-hover-instantiated")))},C=function(t){var o=F(t.target),e=o.closest(".bigfoot-footnote__button"),o=o.closest(".bigfoot-footnote");0<e.length?(t.preventDefault(),T(e)):o.length<1&&0<F(".bigfoot-footnote").length&&i()},T=function(t){var o;t.blur(),o=`data-footnote-identifier='${t.attr("data-footnote-identifier")}'`,t.hasClass("changing")||(t.hasClass("is-active")?v.allowMultipleFN?i(`.bigfoot-footnote[${o}]`):i():(t.addClass("changing"),setTimeout(function(){return t.removeClass("changing")},v.popoverCreateDelay),y(`.bigfoot-footnote__button[${o}]`),t.addClass("is-click-instantiated"),v.allowMultipleFN||i(`.bigfoot-footnote:not([${o}])`)))},y=function(t){var i,a=void 0;return a="string"!=typeof t&&v.allowMultipleFN?t:"string"!=typeof t?t.first():(v.allowMultipleFN?F(t):F(t+":first")).closest(".bigfoot-footnote__button"),i=F(),a.each(function(){var o,t,e=F(this),n=void 0;try{return n=v.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,e.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,e.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,e.attr("data-bigfoot-footnote")).replace(/\&gtsym\;/g,"&gt;").replace(/\&ltsym\;/g,"&lt;"),n=_(n,"BUTTON",e)}finally{(o=F(n)).append('<button class="close-btn">X</button>'),o.append('<button class="hide-show-btn">...</button>'),o.append('<button class="copy-btn" hidden>Copy</button>'),o.find(".copy-btn").on("click",function(){var t=o.find(".bigfoot-footnote__content").text();return navigator.clipboard.writeText(t).then(function(){return alert("Footnote copied to clipboard!")}).catch(function(t){return console.error("Failed to copy text: ",t)})}),o.find(".close-btn").on("click",function(){return o.removeClass("is-active"),e.removeClass("is-active"),setTimeout(function(){return o.remove()},v.popoverDeleteDelay)}),(t=localStorage.getItem("footnote-color"))&&o.find(".bigfoot-footnote__content").css("color",t),o.append('<input type="color" id="color-picker" value="#000000" hidden>'),o.find("#color-picker").val(t),o.find("#color-picker").on("change",function(){return t=F(this).val(),o.find(".bigfoot-footnote__content").css("color",t),localStorage.setItem("footnote-color",t)}),o.find(".hide-show-btn").on("click",function(){return o.find(".copy-btn").toggle()});try{v.activateCallback(o,e)}catch(t){}o.insertAfter(a),p[e.attr("data-footnote-identifier")]="init",o.attr("bigfoot-max-width",x(o.css("max-width"),o)),o.css("max-width",1e4),n=o.find(".bigfoot-footnote__content"),o.attr("data-bigfoot-max-height",x(n.css("max-height"),n)),r(),e.addClass("is-active"),o.find(".bigfoot-footnote__content").bindScrollHandler(),i=i.add(o)}}),setTimeout(function(){return i.addClass("is-active")},v.popoverCreateDelay),i},w=function(){var t,o=document.createElement("div");return o.style.cssText="display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;",o.appendChild(document.createElement("M")),document.body.appendChild(o),t=o.offsetHeight,document.body.removeChild(o),t},x=function(t,o){return"none"===t?t=1e4:0<=t.indexOf("rem")?t=parseFloat(t)*w():0<=t.indexOf("em")?t=parseFloat(t)*parseFloat(o.css("font-size")):0<=t.indexOf("px")?(t=parseFloat(t))<=60&&(t/=parseFloat(o.parent().css("width"))):0<=t.indexOf("%")&&(t=parseFloat(t)/100),t};return F.fn.bindScrollHandler=function(){return v.preventPageScroll&&F(this).on("DOMMouseScroll mousewheel",function(t){var o,e,n,i=F(this),a=i.scrollTop(),r=i[0].scrollHeight,s=parseInt(i.css("height")),l=i.closest(".bigfoot-footnote");if(0<i.scrollTop()&&i.scrollTop()<10&&l.addClass("is-scrollable"),l.hasClass("is-scrollable"))return e=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1},!(n=0<(o="DOMMouseScroll"===t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta))&&r-s-a<-o?(i.scrollTop(r),l.addClass("is-fully-scrolled"),e()):n&&a<o?(i.scrollTop(0),l.removeClass("is-fully-scrolled"),e()):l.removeClass("is-fully-scrolled")}),F(this)},a=function(t){if(v.deleteOnUnhover&&v.activateOnHover)return setTimeout(function(){F(t.target).closest(".bigfoot-footnote, .bigfoot-footnote__button");if(F(".bigfoot-footnote__button:hover, .bigfoot-footnote:hover").length<1)return i()},v.hoverDelay)},o=function(t){if(27===t.keyCode)return i()},i=function(t=".bigfoot-footnote",o=v.popoverDeleteDelay){var e,n=F(),i=void 0,a=void 0;return F(t).each(function(){if(a=F(this),e=a.attr("data-footnote-identifier"),!(i=F(`.bigfoot-footnote__button[data-footnote-identifier='${e}']`)).hasClass("changing"))return n=n.add(i),i.removeClass("is-active is-hover-instantiated is-click-instantiated").addClass("changing"),a.removeClass("is-active").addClass("disapearing"),setTimeout(function(){return a.remove(),delete p[e],i.removeClass("changing")},o)}),n},r=function(t){var c;v.positionContent&&(c=t?t.type:"resize",F(".bigfoot-footnote").each(function(){var t=F(this),o=t.attr("data-footnote-identifier"),e=(t.find(".bigfoot-footnote__content"),t.siblings(".bigfoot-footnote__button")),n=d(e),i=parseFloat(t.css("margin-top")),a=+t.attr("data-bigfoot-max-height"),r=2*i+t.outerHeight(),s=1e4,r=n.bottomRoom<r&&n.topRoom>n.bottomRoom,l=p[o];if(s=r?("top"!==l&&(p[o]="top",t.addClass("is-positioned-top").removeClass("is-positioned-bottom"),t.css("transform-origin",100*n.leftRelative+"% 100%")),n.topRoom-i-15):("bottom"===l&&"init"!==l||(p[o]="bottom",t.removeClass("is-positioned-top").addClass("is-positioned-bottom"),t.css("transform-origin",100*n.leftRelative+"% 0%")),n.bottomRoom-i-15),t.find(".bigfoot-footnote__content").css({"max-height":Math.min(s,a)+"px"}),"resize"===c&&(r=parseFloat(t.attr("bigfoot-max-width")),l=t.find(".bigfoot-footnote__wrapper"),(o=r)<=1&&(i=1e4,v.maxWidthRelativeTo&&0<(s=F(v.maxWidthRelativeTo)).length&&(i=s.outerWidth()),o=Math.min(window.innerWidth,i)*r),o=Math.min(o,t.find(".bigfoot-footnote__content").outerWidth()+1),l.css("max-width",o+"px"),t.css({left:-n.leftRelative*o+parseFloat(e.css("margin-left"))+e.outerWidth()/2+"px"}),f(t,n.leftRelative)),parseInt(t.outerHeight())<t.find(".bigfoot-footnote__content")[0].scrollHeight)return t.addClass("is-scrollable")}))},f=function(t,o=.5){t=t.find(".bigfoot-footnote__tooltip");0<t.length&&t.css("left",100*o+"%")},d=function(t){var o=parseFloat(t.css("margin-left")),o=parseFloat(t.outerWidth())-o,e=parseFloat(t.outerHeight()),n=c(),e=t.offset().top-n.scrollY+e/2,t=t.offset().left-n.scrollX+o/2;return{topRoom:e,bottomRoom:n.height-e,leftRoom:t,rightRoom:n.width-t,leftRelative:t/n.width,topRelative:e/n.height}},c=function(){var t=F(window);return{width:window.innerWidth,height:window.innerHeight,scrollX:t.scrollLeft(),scrollY:t.scrollTop()}},t=function(t,o,e,n=v.popoverDeleteDelay,i=!0){var a=void 0,r=void 0,s=void 0;return(a="string"==typeof t?(s=(r=">"===(s="iphone"===t.toLowerCase()?"<320px":"ipad"===t.toLowerCase()?"<768px":t).charAt(0)?"min":"<"===s.charAt(0)?"max":null)?`(${r}-width: ${s.substring(1)})`:s,window.matchMedia(s)):t).media&&"invalid"===a.media?{added:!1,mq:a,listener:null}:(s="max"===r,o=o||l(i,n,"min"===r,function(t){return t.addClass("is-bottom-fixed")}),e=e||l(i,n,s,function(){}),a.addListener(r=function(t){(t.matches?o:e)(i,u)}),r(a),v.breakpoints[t]={added:!0,mq:a,listener:r},v.breakpoints[t])},l=function(t,n,i,a){return function(t,o){var e=void 0;return t&&(e=o.close(),o.updateSetting("activateCallback",a)),setTimeout(function(){if(o.updateSetting("positionContent",i),t)return o.activate(e)},n)}},n=function(t,o){var e,n=void 0,i=!1;if("string"==typeof t)i=void 0!==v.breakpoints[t];else for(n in v.breakpoints)v.breakpoints.hasOwnProperty(n)&&v.breakpoints[n].mq===t&&(i=!0);return i&&(e=v.breakpoints[n||t],o?o({matches:!1}):e.listener({matches:!1}),e.mq.removeListener(e.listener),delete v.breakpoints[n||t]),i},s=function(t,o){var e,n=void 0;if("string"==typeof t)n=v[t],v[t]=o;else for(e in n={},t)t.hasOwnProperty(e)&&(n[e]=v[e],v[e]=t[e]);return n},e=function(t){return v[t]},F(document).ready(function(){return g(),F(document).on("mouseenter",".bigfoot-footnote__button",h),F(document).on("touchend click",C),F(document).on("mouseout",".is-hover-instantiated",a),F(document).on("keyup",o),F(window).on("scroll resize",r),F(document).on("gestureend",function(){return r()})}),u={removePopovers:i,close:i,createPopover:y,activate:y,repositionFeet:r,reposition:r,addBreakpoint:t,removeBreakpoint:n,getSetting:e,updateSetting:s}}}.call(this);